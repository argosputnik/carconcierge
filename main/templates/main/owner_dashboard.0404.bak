{% extends 'main/base.html' %}
{% block title %}Owner Dashboard{% endblock %}
{% block main_class %}with-padding{% endblock %}

{% block content %}
<h2 class="text-center">Welcome, {{ user.first_name }}!</h2>
<div class="d-flex justify-content-center gap-3 mb-3">
  {% include 'main/_dashboard_buttons.html' %}
</div>

<!-- Activity Table -->
<h3 class="mt-4">Activity</h3>
<div class="table-responsive">
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Request Date</th>
        <th>Name</th>
        <th>Status</th>
        <th>Assigned to</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      {% for request in service_requests %}
      <tr>
        <td>{{ request.requested_at|date:"Y-m-d H:i" }}</td>
        <td>{{ request.customer.first_name }} {{ request.customer.last_name }}</td>
        <td>
          <form method="post" action="{% url 'edit_service_request' request.id %}">
            {% csrf_token %}
            <select name="status" onchange="this.form.submit()">
              <option value="Pending" {% if request.status == "Pending" %}selected{% endif %}>Pending</option>
              <option value="In service" {% if request.status == "In service" %}selected{% endif %}>In service</option>
              <option value="Delivery" {% if request.status == "Delivery" %}selected{% endif %}>Delivery</option>
              <option value="Complete" {% if request.status == "Complete" %}selected{% endif %}>Complete</option>
              <option value="Waiting for Payment" {% if request.status == "Waiting for Payment" %}selected{% endif %}>Waiting for Payment</option>
            </select>
            <input type="hidden" name="update_status_only" value="true">
          </form>
        </td>
        <td>{{ request.assigned_to }}</td>
        <td>{{ request.description }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5" class="text-center">No service requests found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Invoices Table -->
<!-- Invoices Table -->

<!-- Combined Invoice Table -->
<h3 class="mt-4">Invoices</h3>
<div class="table-responsive">
  <table class="table table-striped">
    <thead>
      <tr>
        <th>ID</th>
        <th>Invoice Date</th>
        <th>Name</th>
        <th>Price</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for invoice in invoices1 %}
        <tr>
          <td>{{ invoice.id }}</td>
          <td>{{ invoice.invoice_date|date:"Y-m-d H:i" }}</td>
          <td>{{ invoice.first_name }} {{ invoice.last_name }}</td>
          <td>{{ invoice.price }} {{ invoice.currency }}</td>
          <td>{{ invoice.payment_status }}</td>
          <td>
            <a href="{% url 'view_invoice' 1 invoice.id %}" class="btn btn-info btn-sm">View</a>
          </td>
        </tr>
      {% endfor %}

      {% for invoice in invoices2 %}
        <tr>
          <td>{{ invoice.id }}</td>
          <td>{{ invoice.invoice_date|date:"Y-m-d H:i" }}</td>
          <td>{{ invoice.first_name }} {{ invoice.last_name }}</td>
          <td>{{ invoice.price }} {{ invoice.currency }}</td>
          <td>{{ invoice.payment_status }}</td>
          <td>
            <a href="{% url 'view_invoice' 2 invoice.id %}" class="btn btn-info btn-sm">View</a>
          </td>
        </tr>
      {% endfor %}

      {% if not invoices1 and not invoices2 %}
        <tr>
          <td colspan="6" class="text-center">No invoices found.</td>
        </tr>
      {% endif %}
    </tbody>
  </table>
</div>



{% endblock %}

